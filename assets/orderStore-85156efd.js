import{k as p,l as n,E as l}from"./index-10380651.js";import{T as d}from"./Toast-f77f3f8e.js";const{VITE_APP_URL:u,VITE_APP_PATH:h}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0};p("orderStore",{state:()=>({totalPage:null,totalOrderList:[],courseStudentNumData:[],finalorderInfoData:[],orderInfoData:[]}),mounted(){this.getTotalPage()},watch:{totalPage(){this.getTotalOrderList()}},actions:{getTotalPage(){n.get(`${u}/api/${h}/admin/orders?page=1`).then(t=>{d.fire({icon:"success",title:"取得資料中"}),this.totalPage=t.data.pagination.total_pages,console.log(this.totalPage)}).catch(t=>{d.fire({icon:"error",title:t.response.data.message})})},getTotalOrderList(t){console.log(t);const i=[];for(let r=1;r<=t;r++)i.push(r);const s=i.map(r=>n.get(`${u}/api/${h}/admin/orders?page=${r}`));Promise.all(s).then(r=>{console.log(r),r.forEach(o=>{this.totalOrderList.push(...o.data.orders)}),console.log(this.totalOrderList),this.calcClassmate()}).catch(r=>{console.log(r)}),console.log(this.totalOrderList)},calcClassmate(){const i=[...l(this.totalOrderList)],s=[];i.forEach(e=>{const a=Object.values(e.products);s.push(...a)});const o=s.map(e=>e.product_id).reduce((e,a)=>(e[a]?e[a]++:e[a]=1,e),{});this.courseStudentNumData=o,console.log(this.courseStudentNumData)},getOrderCourseDetail(){this.isLoading=!0;const t=l(this.showStudentNumData),s=Object.keys(t).map(r=>n.get(`${u}/api/${h}/product/${r}`));Promise.all(s).then(r=>{r.forEach(a=>{this.orderInfoData.push({productId:a.data.product.id,title:a.data.product.title,price:a.data.product.price,fundingPrice:a.data.product.funding_price})});const o=[...l(this.orderInfoData)];Object.entries(t).map(([a,c])=>({id:a,classmateNum:c})).forEach(a=>{o.forEach(c=>{a.id===c.productId&&(c.classmateNum=a.classmateNum)})}),console.log(o),this.finalorderInfoData=o,this.isLoading=!1,d.fire({icon:"success",title:"成功取得開課狀況資料"})}).catch(r=>{this.isLoading=!1,console.log(r)})}},getters:{page:({totalPage:t})=>t,sendOrderData:({totalOrderList:t})=>t,showStudentNumData:({courseStudentNumData:t})=>t,showFinalorderInfoData:({finalorderInfoData:t})=>t}});
