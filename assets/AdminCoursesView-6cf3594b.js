import{M as I}from"./modal-d5c36580.js";import{T as p}from"./Toast-835f3f23.js";import{C as E}from"./ckeditor-1e096042.js";import{_ as M,r as P,o as a,c,d as g,b as t,g as _,f as C,t as m,n as r,q as u,p as b,F as D,j as L,v as V,u as T,s as U}from"./index-c26ca672.js";import{D as A}from"./DelModal-aeaeaebc.js";const{VITE_APP_URL:k,VITE_APP_PATH:y}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0},F={data(){return{modal:"",isLoadong:!1,tempProduct:{imagesUrl:[]},editor:E,editorTeacherData:"<p>請輸入講師內容</p>",editorSkillData:"<p>請輸入技能內容</p>",uploadPicData:{},uploadImgs:{}}},props:{checkedCourse:{},checkedStatus:{}},mounted(){this.modal=new I(this.$refs.modal),this.uploadPicData=document.querySelector("#picFile"),this.uploadImgs=document.querySelector("#picsFile"),console.log(this.uploadImgs)},watch:{checkedCourse(){this.tempProduct=this.checkedCourse,this.checkedStatus==="new"&&(this.tempProduct.fundingEndDate="2023-12-01 23:59:59"),console.log(this.tempProduct)}},methods:{createPic(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},uploadPic(){this.isLoadong=!0;const i=this.uploadPicData.files[0],e=new FormData;e.append("file-to-upload",i),this.$http.post(` ${k}/api/${y}/admin/upload`,e).then(n=>{console.log(n.data.imageUrl),console.log(n.data),this.tempProduct.imageUrl=n.data.imageUrl,this.isLoadong=!1,n.data.success===!0&&p.fire({icon:"success",title:"成功上傳圖片"})}).catch(n=>{console.log(n),this.isLoadong=!1,p.fire({icon:"error",title:n.response.data.message})})},uploadSubPic(){console.log(this.uploadImgs.files[0]),this.isLoadong=!0;const i=this.uploadImgs.files[0],e=new FormData;e.append("file-to-upload",i),this.$http.post(` ${k}/api/${y}/admin/upload`,e).then(n=>{console.log(n.data.imageUrl),console.log(n.data),this.tempProduct.imagesUrl.push(n.data.imageUrl),this.isLoadong=!1,n.data.success===!0&&p.fire({icon:"success",title:"成功上傳圖片"})}).catch(n=>{console.log(n),this.isLoadong=!1,p.fire({icon:"error",title:n.response.data.message})})},postCourse(){if(console.log(this.tempProduct.fundingEndDate),this.tempProduct.fundingEndDate=Date.parse(this.tempProduct.fundingEndDate),!this.tempProduct.courseStatus){p.fire({icon:"error",title:"課程狀態必填"});return}if(this.tempProduct.courseStatus==="classFunding"&&(!this.tempProduct.fundingEndDate||!this.tempProduct.funding_price)){p.fire({icon:"error",title:"募資到期日和募資價格必填"});return}let i="",e="";this.checkedStatus==="new"?(i=`${k}/api/${y}/admin/product`,e="post"):this.checkedStatus==="edit"&&(i=`${k}/api/${y}/admin/product/${this.tempProduct.id}`,e="put");const n=this.tempProduct;this.$http[e](i,{data:n}).then(h=>{console.log(h),p.fire({icon:"success",title:h.data.message}),this.$emit("randerCourseList"),this.modal.hide(),this.tempProduct={}}).catch(h=>{p.fire({icon:"error",title:h.response.data.message})})},hideModal(){console.log("hideModal"),this.modal.hide()},showModal(){console.log("showModal"),this.modal.show()}}},R={class:"modal modal-xl modal-dialog-scrollable fade",ref:"modal",tabindex:"-1","aria-hidden":"true"},O={class:"modal-dialog"},B={class:"modal-content"},H={class:"modal-header"},N={class:"modal-title"},j={key:0},q={key:1},X=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},$=t("hr",null,null,-1),G={class:"row"},J={class:"col-sm-4"},K={class:"mb-2"},Q={class:"mb-3"},W=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址或上傳圖檔",-1),Y=["src"],Z=t("h3",null,"多圖新增",-1),tt={key:0},et=["src"],st={key:0},ot={class:"col-sm-8"},lt={class:"mb-3"},it=t("label",{for:"title",class:"form-label"},"標題",-1),nt={class:"row"},dt={class:"mb-3 col-md-6"},at=t("label",{for:"category",class:"form-label"},"分類",-1),ct={class:"mb-3 col-md-6"},rt=t("label",{for:"price",class:"form-label"},"單位",-1),ut={class:"row"},pt={class:"mb-3 col-md-6"},mt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),ht={class:"mb-3 col-md-6"},_t=t("label",{for:"price",class:"form-label"},"售價",-1),gt=t("hr",null,null,-1),ft={class:"bg-light p-3"},bt={class:"row"},Pt={class:"col-md-6"},vt={class:"form-check mb-2"},kt=t("label",{class:"form-check-label",for:"classOpen"}," 已開課 ",-1),yt={class:"form-check mb-2"},Ct=t("label",{class:"form-check-label",for:"classFunding"}," 募資中 ",-1),Dt={class:"row"},Ut={class:"mb-3 col-md-6"},Lt=t("label",{for:"funding_price",class:"form-label"},"募資價(募資課程必填)",-1),St=["disabled"],Vt={class:"mb-3 col-md-6"},wt=t("label",{for:"fundingEndDate",class:"form-label"},"募資結束日(募資課程必填)",-1),xt=["disabled"],Mt=t("hr",null,null,-1),It={class:"mb-3"},Et=t("label",{for:"description",class:"form-label"},"課程簡述(短)",-1),Tt={class:"mb-3"},At=t("label",{for:"content",class:"form-label"},"課程說明(長)",-1),Ft={class:"mb-3"},Rt=t("label",{for:"teacherInfo",class:"form-label"},"講師介紹",-1),Ot={class:"mb-3"},Bt=t("label",{for:"skillTree",class:"form-label"},"技能收穫",-1),Ht={class:"mb-3"},Nt={class:"form-check"},jt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),qt={class:"modal-footer"},Xt=t("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1);function zt(i,e,n,h,s,d){const f=P("LoadingVue"),v=P("ckeditor");return a(),c("div",R,[g(f,{active:i.isLoading,"onUpdate:active":e[0]||(e[0]=o=>i.isLoading=o)},null,8,["active"]),t("div",O,[t("div",B,[t("div",H,[t("h5",N,[n.checkedStatus==="new"?(a(),c("span",j," 新增 ")):n.checkedStatus==="edit"?(a(),c("span",q," 編輯 ")):_("",!0),C(" 課程 ")]),X]),t("div",z,[C(m(s.tempProduct)+" ",1),$,C(" "+m(n.checkedStatus)+" ",1),t("div",G,[t("div",J,[t("div",K,[t("div",Q,[W,r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.tempProduct.imageUrl=o),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[u,s.tempProduct.imageUrl]]),t("input",{type:"file",id:"picFile",style:{display:"none"},ref:"fileInput",onChange:e[2]||(e[2]=o=>d.uploadPic("main"))},null,544),t("button",{onClick:e[3]||(e[3]=o=>this.$refs.fileInput.click()),class:"btn btn-outline-primary mt-2 btn-sm"}," 上傳圖片 ")]),t("img",{class:"img-fluid",src:s.tempProduct.imageUrl,alt:""},null,8,Y)]),Z,t("div",null,[t("input",{type:"file",style:{display:"none"},ref:"imgsFileInput",id:"picsFile",onChange:e[4]||(e[4]=(...o)=>d.uploadSubPic&&d.uploadSubPic(...o))},null,544),t("button",{onClick:e[5]||(e[5]=o=>this.$refs.imgsFileInput.click()),class:b(["btn btn-outline-primary btn-sm mb-2",{disabled:!this.tempProduct.imagesUrl}])}," 上傳圖片 ",2)]),t("div",null,[Array.isArray(s.tempProduct.imagesUrl)?(a(),c("div",tt,[(a(!0),c(D,null,L(s.tempProduct.imagesUrl,(o,l)=>(a(),c("img",{key:l+l,class:"img-fluid",src:s.tempProduct.imagesUrl[l],style:{margin:"0.5rem 0"}},null,8,et))),128)),!s.tempProduct.imagesUrl.length||s.tempProduct.imagesUrl[s.tempProduct.imagesUrl.length-1]?(a(),c("button",{key:0,onClick:e[6]||(e[6]=o=>s.tempProduct.imagesUrl.push("")),class:"btn btn-outline-dark btn-sm d-block w-100"}," 新增圖片 ")):_("",!0),s.tempProduct.imagesUrl.length>0?(a(),c("button",{key:1,onClick:e[7]||(e[7]=o=>s.tempProduct.imagesUrl.pop()),class:"btn btn-outline-danger btn-sm d-block w-100",style:{margin:"0.5rem 0"}}," 刪除圖片 ")):_("",!0)])):_("",!0)]),s.tempProduct.imagesUrl===void 0?(a(),c("div",st,[t("button",{class:"btn btn-outline-dark btn-sm d-block w-100",type:"button",onClick:e[8]||(e[8]=(...o)=>d.createPic&&d.createPic(...o))}," 新增圖片 + ")])):_("",!0)]),t("div",ot,[t("div",lt,[it,r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>s.tempProduct.title=o),id:"title",type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[u,s.tempProduct.title]])]),t("div",nt,[t("div",dt,[at,r(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>s.tempProduct.category=o),id:"category",type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[u,s.tempProduct.category]])]),t("div",ct,[rt,r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>s.tempProduct.unit=o),id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[u,s.tempProduct.unit]])])]),t("div",ut,[t("div",pt,[mt,r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>s.tempProduct.origin_price=o),id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[u,s.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",ht,[_t,r(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>s.tempProduct.price=o),id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[u,s.tempProduct.price,void 0,{number:!0}]])])]),gt,t("div",ft,[t("div",bt,[t("div",Pt,[t("div",vt,[r(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>s.tempProduct.courseStatus=o),value:"classOpen",class:"form-check-input",type:"radio",name:"courseStatus",id:"classOpen"},null,512),[[V,s.tempProduct.courseStatus]]),kt]),t("div",yt,[r(t("input",{"onUpdate:modelValue":e[15]||(e[15]=o=>s.tempProduct.courseStatus=o),value:"classFunding",class:"form-check-input",type:"radio",name:"courseStatus",id:"classFunding"},null,512),[[V,s.tempProduct.courseStatus]]),Ct])])]),t("div",Dt,[t("div",Ut,[Lt,r(t("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":e[16]||(e[16]=o=>s.tempProduct.funding_price=o),id:"funding_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入募資優惠價"},null,8,St),[[u,s.tempProduct.funding_price,void 0,{number:!0}]])]),t("div",Vt,[wt,r(t("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":e[17]||(e[17]=o=>s.tempProduct.fundingEndDate=o),id:"fundingEndDate",type:"text",class:"form-control",placeholder:"2023-01-01 23:59:59"},null,8,xt),[[u,s.tempProduct.fundingEndDate]])])])]),Mt,t("div",It,[Et,r(t("textarea",{"onUpdate:modelValue":e[18]||(e[18]=o=>s.tempProduct.description=o),id:"description",type:"text",class:"form-control",placeholder:"請輸入課程簡述"},`
                `,512),[[u,s.tempProduct.description]])]),t("div",Tt,[At,r(t("textarea",{"onUpdate:modelValue":e[19]||(e[19]=o=>s.tempProduct.content=o),id:"description",type:"text",class:"form-control",placeholder:"請輸入課程說明內容"},`
                `,512),[[u,s.tempProduct.content]])]),t("div",Ft,[Rt,g(v,{editor:s.editor,modelValue:s.tempProduct.teacherInfo,"onUpdate:modelValue":e[20]||(e[20]=o=>s.tempProduct.teacherInfo=o)},null,8,["editor","modelValue"])]),t("div",Ot,[Bt,g(v,{editor:s.editor,modelValue:s.tempProduct.skillTree,"onUpdate:modelValue":e[21]||(e[21]=o=>s.tempProduct.skillTree=o)},null,8,["editor","modelValue"])]),t("div",Ht,[t("div",Nt,[r(t("input",{"onUpdate:modelValue":e[22]||(e[22]=o=>s.tempProduct.is_enabled=o),id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[T,s.tempProduct.is_enabled]]),jt])])])])]),t("div",qt,[Xt,t("button",{onClick:e[23]||(e[23]=(...o)=>d.postCourse&&d.postCourse(...o)),type:"button",class:"btn btn-danger"}," 送出 ")])])])],512)}const $t=M(F,[["render",zt]]),{VITE_APP_URL:w,VITE_APP_PATH:x}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0},Gt={data(){return{isLoading:!1,allCourseList:{},currentPage:1,delClassTitle:"",delClassId:"",checkedCourse:{},checkedStatus:"",todayDateStr:"",leftDay:""}},components:{CourseModal:$t,DelModal:A},mounted(){this.getCoursesList(),setInterval(()=>{this.todayDateStr=Date.parse(new Date)},6e4)},watch:{todayDateStr(){this.countDay()}},methods:{updateTodayDate(){this.todayDateStr=Date.parse(new Date);const i=setInterval(()=>{this.todayDateStr=Date.parse(new Date),this.endTimeStr<=this.todayDateStr&&(this.leftDay="此募資已結束",clearInterval(i))},6e4)},countDay(i){this.todayDateStr=Date.parse(new Date);const e=(i-this.todayDateStr)/1e3/36e3/24,n=Math.floor(e),h=(e-n)*24,s=Math.floor(h),d=(h-s)*60,f=Math.floor(d);return console.log("有跑"),this.leftDay=`剩餘天數：${n}天${s}小時${f}分鐘`},getCoursesList(i=1){this.isLoading=!0,this.$http.get(`${w}/api/${x}/admin/products?page=${i}`).then(e=>{console.log(e.data),this.isLoading=!1,this.allCourseList=e.data,e.data.success===!0&&p.fire({icon:"success",title:"成功取得產品資訊"})}).catch(e=>{this.isLoading=!1,console.log(e)})},changePage(i){this.currentPage=i,this.getCoursesList(this.currentPage)},openModal(i,e){e==="edit"?this.checkedCourse=i:e==="new"&&(this.checkedCourse={}),this.checkedStatus=e,console.log(this.checkedStatus),this.$refs.courseModal.showModal()},openDelModal(i,e){console.log(i,e),this.delClassTitle=i,this.delClassId=e,this.$refs.deleteModal.showModal()},delCourse(){const i=this.delClassId;this.$http.delete(`${w}/api/${x}/admin/product/${i}`).then(e=>{p.fire({icon:"success",title:e.data.message}),this.getCoursesList(this.currentPage)}).catch(e=>{console.log(e)})}}},Jt=t("h3",{class:"text-center mt-5"},"課程管理",-1),Kt={class:"text-end"},Qt={class:"card mt-4"},Wt={class:"card-body p-0"},Yt={class:"table-responsive text-nowrap"},Zt={class:"table table-hover"},te=t("thead",{class:"border-bottom border-3 bg-light"},[t("tr",{class:"align-middle"},[t("th",{scope:"col ",class:"ps-3"},"分類"),t("th",{scope:"col",class:"py-3"},"課程名稱"),t("th",{scope:"col"},"課程狀態 ( 若募資:剩XX天 )"),t("th",{scope:"col",class:"text-end"},"原價"),t("th",{scope:"col",class:"text-end"},"售價"),t("th",{scope:"col",class:"text-end"},"是否上線"),t("th",{scope:"col",class:"text-end pe-3"},"編輯")])],-1),ee={class:"py-3 ps-3"},se={class:""},oe={key:0},le={class:"text-success"},ie={key:1},ne={class:"text-end"},de={class:"text-end"},ae={class:"text-end"},ce={class:"text-end pe-3 text-danger"},re={class:"btn-group",role:"group"},ue=["onClick"],pe=["onClick"],me={class:"card-footer bg-transparent border-0 pb-0"},he={"aria-label":"Page navigation mb-0 "},_e={key:0,class:"pagination justify-content-center"},ge=t("a",{class:"page-link",href:"","aria-label":"Previous"},[t("span",{"aria-hidden":"true"},"«")],-1),fe=[ge],be=["onClick"],Pe={class:"page-link",href:"#"},ve=t("a",{class:"page-link",href:"#","aria-label":"Next"},[t("span",{"aria-hidden":"true"},"»")],-1),ke=[ve];function ye(i,e,n,h,s,d){const f=P("LoadingVue"),v=P("CourseModal"),o=P("DelModal");return a(),c(D,null,[Jt,t("div",Kt,[t("button",{onClick:e[0]||(e[0]=l=>d.openModal(0,"new")),class:"btn btn-outline-secondary"}," 新增課程 ")]),g(f,{active:s.isLoading,"onUpdate:active":e[1]||(e[1]=l=>s.isLoading=l)},null,8,["active"]),t("div",Qt,[t("div",Wt,[t("div",Yt,[t("table",Zt,[te,t("tbody",null,[(a(!0),c(D,null,L(s.allCourseList.products,l=>(a(),c("tr",{class:"align-middle",key:l.id},[t("td",ee,m(l.category),1),t("td",se,m(l.title),1),l.courseStatus==="classFunding"?(a(),c("td",oe,[C(" 募資中 "),t("span",le," 結束日 "+m(l.fundingEndDate)+" "+m(d.countDay(l.fundingEndDate)),1)])):l.courseStatus==="classOpen"?(a(),c("td",ie,"已開課")):_("",!0),t("td",ne,m(l.origin_price)+"4",1),t("td",de,m(l.price)+"5",1),t("td",ae,[t("div",{class:b(["badge rounded-pill",[{"bg-warning":l.is_enabled===1},{"bg-dark":l.is_enabled===0||!l.is_enabled}]])},m(l.is_enabled?"上線中":"未上"),3)]),t("td",ce,[t("div",re,[t("button",{onClick:S=>d.openModal(l,"edit"),type:"button",class:"btn btn-outline-dark btn-sm"}," 編輯 ",8,ue),t("button",{onClick:S=>d.openDelModal(l.title,l.id),type:"button",class:"btn btn-outline-primary btn-sm"}," 刪除 ",8,pe)])])]))),128))])])])]),t("div",me,[t("nav",he,[s.allCourseList.pagination?(a(),c("ul",_e,[t("li",{class:b(["page-item",{disabled:!s.allCourseList.pagination.has_pre}]),onClick:e[2]||(e[2]=U(l=>d.changePage(s.currentPage-1),["prevent"]))},fe,2),(a(!0),c(D,null,L(s.allCourseList.pagination.total_pages,l=>(a(),c("li",{class:b(["page-item",{active:l===s.currentPage}]),key:l+"hlllq",onClick:U(S=>d.changePage(l),["prevent"])},[t("a",Pe,m(l),1)],10,be))),128)),t("li",{class:b(["page-item",{disabled:!s.allCourseList.pagination.has_next}]),onClick:e[3]||(e[3]=U(l=>d.changePage(s.currentPage+1),["prevent"]))},ke,2)])):_("",!0)])])]),g(v,{ref:"courseModal","checked-course":s.checkedCourse,"checked-status":s.checkedStatus,onRanderCourseList:e[4]||(e[4]=l=>d.getCoursesList(s.currentPage))},null,8,["checked-course","checked-status"]),g(o,{ref:"deleteModal","del-class-title":s.delClassTitle,"del-class-id":s.delClassId,onDelItem:d.delCourse},null,8,["del-class-title","del-class-id","onDelItem"])],64)}const Ve=M(Gt,[["render",ye]]);export{Ve as default};
