import{T as p}from"./Toast-e4cc08f6.js";import{D as P}from"./DelModal-23a26c0e.js";import{M as y}from"./modal-edd18884.js";import{_ as k,o as d,c as n,a as t,t as o,F as h,E as u,k as D,r as m,e as g,J as b,h as v}from"./index-4afa8807.js";import"./base-component-7ff95e87.js";const x={data(){return{modal:""}},props:["checkOrderData"],mounted(){this.modal=new y(this.$refs.orderModal)},watch:{},methods:{hideModal(){this.modal.hide()},showModal(){this.modal.show()}}},w={class:"modal fade",ref:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},C={class:"modal-dialog modal-lg"},V={class:"modal-content"},E=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單詳情"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I={key:0,class:"modal-body"},A={class:"row"},T={class:"col"},N={class:"ms-3"},B=t("h4",null,"用戶資料",-1),R={class:"table"},S={class:"tbody"},U=t("th",{scope:"row"},"姓名",-1),F=t("th",{scope:"row"},"電話",-1),H=t("th",{scope:"row"},"email",-1),j=t("th",{scope:"row"},"付款方式",-1),q={class:"col"},z=t("h4",null,"訂單資料",-1),J={class:"table"},G={class:"tbody"},K=t("th",{scope:"row"},"訂單編號",-1),Q=t("th",{scope:"row"},"下單時間",-1),W=t("th",{scope:"row"},"總金額",-1),X=t("th",{scope:"row"},"訂購品項",-1),Y=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-primary text-white","data-bs-dismiss":"modal"}," 關閉 ")],-1);function Z(a,s,r,L,l,i){return d(),n("div",w,[t("div",C,[t("div",V,[E,r.checkOrderData.order?(d(),n("div",I,[t("div",A,[t("div",T,[t("div",N,[B,t("table",R,[t("div",S,[t("tr",null,[U,t("td",null,o(r.checkOrderData.order.user.name),1)]),t("tr",null,[F,t("td",null,o(r.checkOrderData.order.user.tel),1)]),t("tr",null,[H,t("td",null,o(r.checkOrderData.order.user.email),1)]),t("tr",null,[j,t("td",null,o(r.checkOrderData.order.user.payment),1)])])])])]),t("div",q,[z,t("table",J,[t("div",G,[t("tr",null,[K,t("td",null,o(r.checkOrderData.order.id),1)]),t("tr",null,[Q,t("td",null,o(new Date(r.checkOrderData.order.create_at*1e3).toLocaleDateString()),1)]),t("tr",null,[W,t("td",null,o(r.checkOrderData.order.total),1)]),t("tr",null,[X,t("td",null,[(d(!0),n(h,null,u(r.checkOrderData.order.products,_=>(d(),n("p",{key:_.id,class:"mb-0"},o(_.product.title),1))),128))])])])])])])])):D("",!0),Y])])],512)}const tt=k(x,[["render",Z]]),{VITE_APP_URL:f,VITE_APP_PATH:O}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vue-learnFund/",MODE:"production",DEV:!1,PROD:!0},et={data(){return{delId:"",checkOrderData:{},allOrderList:[],isLoading:!1,currentPage:1,totalOrderList:[],totalPage:1,courseStudentNumData:{}}},components:{DelModal:P,OrderDetailModal:tt},mounted(){this.getOrderList()},methods:{getOrderList(a=1){this.isLoading=!0,this.$http.get(`${f}/api/${O}/admin/orders?page=${a}`).then(s=>{this.isLoading=!1,p.fire({icon:"success",title:"成功取得資料"}),this.allOrderList=s.data,this.totalPage=s.data.pagination.total_pages}).catch(s=>{this.isLoading=!1,p.fire({icon:"error",title:s.response.data.message})})},changePage(a){a>this.totalPage||a===0||(this.currentPage=a,this.getOrderList(this.currentPage))},openDelModal(a){this.delId=a,this.$refs.deleteModal.showModal()},openOrderModal(a){this.isLoading=!0,this.$http.get(`${f}/api/${O}/order/${a}`).then(s=>{this.checkOrderData=s.data,this.isLoading=!1}).catch(()=>{this.isLoading=!1}),this.$refs.orderDetailModal.showModal()},delOrder(){const a=this.delId;this.$http.delete(`${f}/api/${O}/admin/order/${a}`).then(()=>{this.getOrderList(this.currentPage),this.$refs.deleteModal.hideModal()}).catch(s=>{p.fire({icon:"error",title:s.response.data.message})})}}},st=t("h3",{class:"text-center mt-5"},"訂單管理",-1),ot={class:"card mt-4"},at={class:"card-body p-0"},lt={class:"table-responsive text-nowrap"},dt={class:"table table-hover"},nt=t("thead",{class:"border-bottom border-3 bg-light"},[t("tr",{class:"align-middle"},[t("th",{scope:"col ",class:"ps-3"}),t("th",{scope:"col",class:"py-3"},"訂單編號"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"用戶名"),t("th",{scope:"col"},"購買品項"),t("th",{scope:"col",class:"text-end"},"付款方式"),t("th",{scope:"col",class:"text-end"},"金額"),t("th",{scope:"col",class:"text-end pe-3"},"訂單編輯")])],-1),rt=t("td",{class:"py-3 ps-3"},null,-1),it={class:""},ct={class:"ps-2 px-0 mb-0"},ht={class:"text-end"},_t={class:"text-end"},ut={class:"text-end pe-3 text-danger"},pt={class:"btn-group",role:"group"},mt=["onClick"],gt=["onClick"],bt={key:0,class:"card-footer bg-transparent border-0 pb-0"},vt={"aria-label":"Page navigation mb-0 "},ft={class:"pagination justify-content-center"},Ot=t("a",{class:"page-link",href:"","aria-label":"Previous"},[t("span",{"aria-hidden":"true"},"«")],-1),kt=[Ot],Dt=["onClick"],Lt={class:"page-link",href:"#"},Mt=t("a",{class:"page-link","aria-label":"Next"},[t("span",{"aria-hidden":"true"},"»")],-1),$t=[Mt];function Pt(a,s,r,L,l,i){const _=m("LoadingVue"),M=m("DelModal"),$=m("OrderDetailModal");return d(),n(h,null,[st,g(_,{active:l.isLoading,"onUpdate:active":s[0]||(s[0]=e=>l.isLoading=e)},null,8,["active"]),t("div",ot,[t("div",at,[t("div",lt,[t("table",dt,[nt,t("tbody",null,[(d(!0),n(h,null,u(l.allOrderList.orders,e=>(d(),n("tr",{class:"align-middle",key:e.id},[rt,t("td",it,o(e.id),1),t("td",null,o(e.user.email),1),t("td",null,o(e.user.name),1),t("td",null,[t("ol",ct,[(d(!0),n(h,null,u(e.products,c=>(d(),n("li",{key:c.id},o(c.product.title),1))),128))])]),t("td",ht,o(e.user.payment),1),t("td",_t,o(Math.round(e.total)),1),t("td",ut,[t("div",pt,[t("button",{onClick:c=>i.openOrderModal(e.id),type:"button",class:"btn btn-outline-dark btn-sm"}," 檢視 ",8,mt),t("button",{onClick:c=>i.openDelModal(e.id),type:"button",class:"btn btn-outline-primary btn-sm"}," 刪除 ",8,gt)])])]))),128))])])])]),l.allOrderList.pagination?(d(),n("div",bt,[t("nav",vt,[t("ul",ft,[t("li",{class:b(["page-item",{disabled:!l.allOrderList.pagination.has_pre}]),onClick:s[1]||(s[1]=v(e=>i.changePage(l.currentPage-1),["prevent"]))},kt,2),(d(!0),n(h,null,u(l.allOrderList.pagination.total_pages,e=>(d(),n("li",{class:b(["page-item",{active:e===l.currentPage}]),key:e+"hlllq",onClick:v(c=>i.changePage(e),["prevent"])},[t("a",Lt,o(e),1)],10,Dt))),128)),t("li",{class:b(["page-item",{disabled:!l.allOrderList.pagination.has_next}]),onClick:s[2]||(s[2]=v(e=>i.changePage(l.currentPage+1),["prevent"]))},$t,2)])])])):D("",!0)]),g(M,{onDelItem:i.delOrder,"del-id":l.delId,ref:"deleteModal"},null,8,["onDelItem","del-id"]),g($,{"check-order-data":l.checkOrderData,ref:"orderDetailModal"},null,8,["check-order-data"])],64)}const Et=k(et,[["render",Pt]]);export{Et as default};
