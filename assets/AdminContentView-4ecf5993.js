import{D as C}from"./DelModal-aeaeaebc.js";import{M as $}from"./modal-d5c36580.js";import{T as p}from"./Toast-835f3f23.js";import{C as E}from"./ckeditor-1e096042.js";import{_ as w,r as _,o as n,c as d,d as g,b as t,g as M,f as L,t as r,n as h,q as u,u as U,F as A,j as x,p as f,s as T}from"./index-c26ca672.js";const{VITE_APP_URL:v,VITE_APP_PATH:P}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0},S={data(){return{isLoading:!1,modal:"",articlePicData:{},tempArticle:{},editor:E,editorData:"<p>請輸入文章內容</p>"}},props:{item:{},status:{}},mounted(){this.modal=new $(this.$refs.modal),this.articlePicData=this.$refs.articlePic},watch:{item(){if(this.tempArticle=this.item,console.log(this.tempArticle),console.log(this.tempArticle.id),this.tempArticle.id){this.isLoading=!0;const i=this.tempArticle.id;this.$http.get(`${v}/api/${P}/admin/article/${i}`).then(e=>{console.log(e.data),console.log(e.data.article.content),this.editorData=e.data.article.content,this.isLoading=!1}).catch(e=>{console.log(e),this.isLoading=!1})}}},methods:{uploadArticlePic(){const i=this.articlePicData.files[0],e=new FormData;e.append("file-to-upload",i),this.$http.post(` ${v}/api/${P}/admin/upload`,e).then(a=>{console.log(a.data.imageUrl),console.log(a.data),this.tempArticle.image=a.data.imageUrl,this.isLoadong=!1,a.data.success===!0&&p.fire({icon:"success",title:"成功上傳圖片"})}).catch(a=>{console.log(a),this.isLoadong=!1,p.fire({icon:"error",title:a.response.data.message})})},switchTimeStamp(i){if(console.log(typeof i),typeof i=="number")return console.log(i),this.tempArticle.create_at=new Date(i*1e3).toISOString().split("T")[0],this.tempArticle.create_at},postArticle(){if(!this.tempArticle.tag){p.fire({icon:"error",title:"標籤不可為空"});return}let i="",e="";console.log(this.tempArticle),this.tempArticle.content=this.editorData,Array.isArray(this.tempArticle.tag)||(this.tempArticle.tag=this.tempArticle.tag.split(",")),this.status==="new"?(i=`${v}/api/${P}/admin/article`,e="post"):this.status==="edit"&&(i=`${v}/api/${P}/admin/article/${this.tempArticle.id}`,e="put"),this.tempArticle.create_at=Date.parse(this.tempArticle.create_at)/1e3;const a=this.tempArticle;console.log(a),this.$http[e](i,{data:a}).then(m=>{p.fire({icon:"success",title:m.data.message}),this.modal.hide(),this.$emit("renderPage")}).catch(m=>{alert(m.response.data.message)})},hideModal(){console.log("hideModal"),this.modal.hide()},showModal(){console.log("showModal"),this.modal.show()}}},R={class:"modal modal-xl fade",id:"exampleModal",tabindex:"-1",ref:"modal","aria-hidden":"true"},O={class:"modal-dialog"},N={class:"modal-content"},B={class:"modal-header"},H={class:"modal-title"},j={key:0},F={key:1},q=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},z={class:"row"},G={class:"col-md-4"},K={class:"mb-3"},Q={class:"col-md-8"},W={class:"mb-3"},X=["src"],Y=t("hr",null,null,-1),Z={class:"col-md-8"},tt={class:"mb-3"},et=t("label",{for:"title",class:"form-label"},"標題",-1),st={class:"col-md-4"},it={class:"mb-3"},lt=t("label",{for:"author",class:"form-label"},"作者",-1),ot={class:"col-md-6"},at={class:"mb-3"},ct=t("label",{for:"tag",class:"form-label"},"標籤(請用,間隔)",-1),nt={class:"col-md-6"},dt={class:"mb-3"},rt=t("label",{for:"createdTime",class:"form-label"},"建立時間",-1),ht={class:"col-md-12"},pt={class:"mb-3"},mt={class:"form-check"},ut=t("label",{class:"form-check-label",for:"isPublic"},"是否公開",-1),_t={class:"col-md-12"},gt={class:"mb-3"},bt=t("label",{for:"description",class:"form-label"}," 文章引言",-1),At={class:"col-md-12"},ft={class:"modal-footer"},vt=t("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1);function Pt(i,e,a,m,s,c){const k=_("LoadingVue"),y=_("ckeditor");return n(),d("div",R,[g(k,{active:s.isLoading,"onUpdate:active":e[0]||(e[0]=o=>s.isLoading=o)},null,8,["active"]),t("div",O,[t("div",N,[t("div",B,[t("h5",H,[a.status==="new"?(n(),d("span",j," 新增 ")):a.status==="edit"?(n(),d("span",F," 編輯 ")):M("",!0),L(" 文章 ")]),q]),L(" "+r(s.tempArticle)+" ||| "+r(a.status)+" ||| "+r(a.item)+" ",1),t("div",J,[t("div",z,[t("div",G,[t("div",K,[t("input",{style:{display:"none"},type:"file",ref:"articlePic",id:"articlePicFile",onChange:e[1]||(e[1]=(...o)=>c.uploadArticlePic&&c.uploadArticlePic(...o))},null,544),t("button",{onClick:e[2]||(e[2]=o=>this.$refs.articlePic.click()),class:"btn btn-primary text-white",type:"button"}," 上傳主圖 ")])]),t("div",Q,[t("div",W,[t("img",{class:"img-fluid",src:s.tempArticle.image,alt:""},null,8,X)])]),Y,t("div",Z,[t("div",tt,[et,h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.tempArticle.title=o),id:"title",type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[u,s.tempArticle.title]])])]),t("div",st,[t("div",it,[lt,h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.tempArticle.author=o),id:"author",type:"text",class:"form-control",placeholder:"請輸入作者名稱"},null,512),[[u,s.tempArticle.author]])])]),t("div",ot,[t("div",at,[ct,h(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.tempArticle.tag=o),id:"tag",type:"text",class:"form-control",placeholder:"範例: 關鍵字1,關鍵字2"},null,512),[[u,s.tempArticle.tag]])])]),t("div",nt,[t("div",dt,[rt,L(" "+r(c.switchTimeStamp(s.tempArticle.create_at))+" ",1),h(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.tempArticle.create_at=o),id:"createdTime",type:"date",class:"form-control"},null,512),[[u,s.tempArticle.create_at]])])]),t("div",ht,[t("div",pt,[t("div",mt,[h(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.tempArticle.isPublic=o),id:"isPublic",class:"form-check-input",type:"checkbox"},null,512),[[U,s.tempArticle.isPublic]]),ut])])]),t("div",_t,[t("div",gt,[bt,h(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=o=>s.tempArticle.description=o),id:"description",class:"form-control"},`
                `,512),[[u,s.tempArticle.description]])])]),t("div",At,[g(y,{editor:s.editor,modelValue:s.editorData,"onUpdate:modelValue":e[9]||(e[9]=o=>s.editorData=o)},null,8,["editor","modelValue"])])])]),t("div",ft,[vt,t("button",{onClick:e[10]||(e[10]=(...o)=>c.postArticle&&c.postArticle(...o)),type:"button",class:"btn btn-outline-danger"}," 送出 ")])])])],512)}const kt=w(S,[["render",Pt]]),{VITE_APP_URL:D,VITE_APP_PATH:V}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0},yt={data(){return{isLoading:!1,allArticleList:{},checkedItem:{},checkedStatus:"",currentPage:1,delArticleTitle:"",delArticleId:""}},components:{DelModal:C,ArticleModal:kt},mounted(){this.getAllArticleList()},watch:{},methods:{switchTime(i){const e=JSON.parse(JSON.stringify(i));return console.log(e),new Date(e*1e3).toISOString().split("T")[0]},getAllArticleList(i=1){this.isLoading=!0,this.$http.get(`${D}/api/${V}/admin/articles?page=${i}`).then(e=>{console.log(e.data),this.allArticleList=e.data,e.data.success===!0&&p.fire({icon:"success",title:"成功取得文章列表"}),this.isLoading=!1}).catch(e=>{this.isLoading=!1,alert(e.response.data.message)})},changePage(i){this.currentPage=i,this.getAllArticleList(this.currentPage)},deleteArticle(){const i=this.delArticleId;this.$http.delete(`${D}/api/${V}/admin/article/${i}`).then(e=>{console.log(e.data),p.fire({icon:"success",title:e.data.message}),this.getAllArticleList(this.currentPage)}).catch(e=>{alert(e.response.data.message)})},openDelModal(i,e){console.log(i,e),this.delArticleTitle=i,this.delArticleId=e,this.$refs.deleteModal.showModal()},openModal(i,e){console.log(i,e),e==="new"?this.checkedItem={isPublic:!0}:e==="edit"&&(this.checkedItem=i),this.checkedStatus=e,this.$refs.articleModal.showModal()}}},Lt=t("h3",{class:"text-center mt-5"},"文章管理",-1),xt={class:"text-end mb-4"},Tt={class:"card"},Dt={class:"card-body p-0"},Vt={class:"table-responsive text-nowrap"},wt={class:"table table-hover"},Mt=t("thead",{class:"border-bottom border-3 bg-light"},[t("tr",{class:"align-middle"},[t("th",{scope:"col ",class:"ps-3"},"標題"),t("th",{scope:"col",class:"py-3"},"作者"),t("th",{scope:"col"},"標籤"),t("th",{scope:"col",class:"text-end"},"建立時間"),t("th",{scope:"col",class:"text-end"},"是否公開"),t("th",{scope:"col",class:"text-end pe-3"},"編輯")])],-1),It={class:"py-3 ps-3"},Ct={class:""},$t={key:0,class:"text-end"},Et={key:1,class:"text-end"},Ut={class:"text-end"},St={class:"text-end pe-3 text-danger"},Rt={class:"btn-group",role:"group"},Ot=["onClick"],Nt=["onClick"],Bt={class:"card-footer bg-transparent border-0 pb-0"},Ht={"aria-label":"Page navigation mb-0 "},jt={key:0,class:"pagination justify-content-center"},Ft=t("a",{class:"page-link",href:"","aria-label":"Previous"},[t("span",{"aria-hidden":"true"},"«")],-1),qt=[Ft],Jt=["onClick"],zt={class:"page-link",href:"#"},Gt=t("a",{class:"page-link",href:"#","aria-label":"Next"},[t("span",{"aria-hidden":"true"},"»")],-1),Kt=[Gt];function Qt(i,e,a,m,s,c){const k=_("LoadingVue"),y=_("DelModal"),o=_("ArticleModal");return n(),d(A,null,[Lt,t("div",xt,[t("button",{onClick:e[0]||(e[0]=l=>c.openModal(0,"new")),class:"btn btn-outline-secondary"}," 新增文章 ")]),g(k,{active:s.isLoading,"onUpdate:active":e[1]||(e[1]=l=>s.isLoading=l)},null,8,["active"]),t("div",Tt,[t("div",Dt,[t("div",Vt,[t("table",wt,[Mt,t("tbody",null,[(n(!0),d(A,null,x(s.allArticleList.articles,l=>(n(),d("tr",{class:"align-middle",key:l.id},[t("td",It,r(l.title)+" 1",1),t("td",Ct,r(l.author),1),t("td",null,[(n(!0),d(A,null,x(l.tag,(b,I)=>(n(),d("span",{key:I+"1232",class:"badge bg-success me-1"},r(b),1))),128))]),typeof l.create_at=="number"?(n(),d("td",$t,r(new Date(l.create_at*1e3).toISOString().split("T")[0]),1)):(n(),d("td",Et,r(l.create_at),1)),t("td",Ut,[t("div",{class:f(["badge rounded-pill",[{"bg-warning":l.isPublic===!0},{"bg-dark":l.isPublic===!1}]])},r(l.isPublic?"公開":"未公開"),3)]),t("td",St,[t("div",Rt,[t("button",{onClick:b=>c.openModal(l,"edit"),type:"button",class:"btn btn-outline-dark btn-sm"}," 編輯 ",8,Ot),t("button",{onClick:b=>c.openDelModal(l.title,l.id),type:"button",class:"btn btn-outline-primary btn-sm"}," 刪除 ",8,Nt)])])]))),128))])])])]),t("div",Bt,[t("nav",Ht,[s.allArticleList.pagination?(n(),d("ul",jt,[t("li",{class:f(["page-item",{disabled:!s.allArticleList.pagination.has_pre}]),onClick:e[2]||(e[2]=T(l=>c.changePage(s.currentPage-1),["prevent"]))},qt,2),(n(!0),d(A,null,x(s.allArticleList.pagination.total_pages,l=>(n(),d("li",{class:f(["page-item",{active:l===s.currentPage}]),key:l+"hlllq",onClick:T(b=>c.changePage(l),["prevent"])},[t("a",zt,r(l),1)],10,Jt))),128)),t("li",{class:f(["page-item",{disabled:!s.allArticleList.pagination.has_next}]),onClick:e[3]||(e[3]=T(l=>c.changePage(s.currentPage+1),["prevent"]))},Kt,2)])):M("",!0)])])]),g(y,{ref:"deleteModal","del-article-title":s.delArticleTitle,"del-article-id":s.delArticleId,onDelItem:c.deleteArticle},null,8,["del-article-title","del-article-id","onDelItem"]),g(o,{ref:"articleModal",item:s.checkedItem,status:s.checkedStatus,onRenderPage:e[4]||(e[4]=l=>c.getAllArticleList(s.currentPage))},null,8,["item","status"])],64)}const ee=w(yt,[["render",Qt]]);export{ee as default};
