import{M as T}from"./modal-b78111fb.js";import{T as u}from"./Toast-70698817.js";import{C as I}from"./ckeditor-e8e1a9e2.js";import{_ as w,r as b,o as d,c as r,d as f,b as e,g as h,f as C,n as c,q as p,p as g,F as y,j as L,v as x,t as m,u as M,s as U}from"./index-2452b9d6.js";import{D as A}from"./DelModal-070fb714.js";const{VITE_APP_URL:v,VITE_APP_PATH:k}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0},F={data(){return{modal:"",isLoadong:!1,tempProduct:{imagesUrl:[]},editor:I,editorTeacherData:"<p>請輸入講師內容</p>",editorSkillData:"<p>請輸入技能內容</p>",uploadPicData:{},uploadImgs:{}}},props:{checkedCourse:{},checkedStatus:{}},mounted(){this.modal=new T(this.$refs.modal),this.uploadPicData=document.querySelector("#picFile"),this.uploadImgs=document.querySelector("#picsFile")},watch:{checkedCourse(){this.tempProduct=this.checkedCourse}},methods:{switchTimeStamp(i){if(typeof i!="number")return;this.tempProduct.fundingEndDate=new Date(i).toISOString();const n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})/.exec(this.tempProduct.fundingEndDate);return this.tempProduct.fundingEndDate=`${n[1]}-${n[2]}-${n[3]}T${n[4]}:${n[5]}`},createPic(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},uploadPic(){this.isLoadong=!0;const i=this.uploadPicData.files[0],t=new FormData;t.append("file-to-upload",i),this.$http.post(` ${v}/api/${k}/admin/upload`,t).then(n=>{this.tempProduct.imageUrl=n.data.imageUrl,this.isLoadong=!1,n.data.success===!0&&u.fire({icon:"success",title:"成功上傳圖片"})}).catch(n=>{this.isLoadong=!1,u.fire({icon:"error",title:n.response.data.message})})},uploadSubPic(){this.isLoadong=!0;const i=this.uploadImgs.files[0],t=new FormData;t.append("file-to-upload",i),this.$http.post(` ${v}/api/${k}/admin/upload`,t).then(n=>{this.tempProduct.imagesUrl.push(n.data.imageUrl),this.isLoadong=!1,n.data.success===!0&&u.fire({icon:"success",title:"成功上傳圖片"})}).catch(n=>{this.isLoadong=!1,u.fire({icon:"error",title:n.response.data.message})})},postCourse(){if(this.tempProduct.fundingEndDate=Date.parse(this.tempProduct.fundingEndDate),!this.tempProduct.courseStatus){u.fire({icon:"error",title:"課程狀態必填"});return}if(this.tempProduct.courseStatus==="classFunding"&&(!this.tempProduct.fundingEndDate||!this.tempProduct.funding_price)){u.fire({icon:"error",title:"募資到期日和募資價格必填"});return}let i="",t="";this.checkedStatus==="new"?(i=`${v}/api/${k}/admin/product`,t="post"):this.checkedStatus==="edit"&&(i=`${v}/api/${k}/admin/product/${this.tempProduct.id}`,t="put");const n=this.tempProduct;this.$http[t](i,{data:n}).then(_=>{u.fire({icon:"success",title:_.data.message}),this.$emit("randerCourseList"),this.modal.hide(),this.tempProduct={}}).catch(_=>{u.fire({icon:"error",title:_.response.data.message})})},hideModal(){this.modal.hide()},showModal(){this.modal.show()}}},O={class:"modal modal-xl modal-dialog-scrollable fade",ref:"modal",tabindex:"-1","aria-hidden":"true"},R={class:"modal-dialog"},$={class:"modal-content"},B={class:"modal-header"},H={class:"modal-title"},N={key:0},j={key:1},q=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},G={class:"row"},J={class:"col-sm-4"},K={class:"mb-2"},Q={class:"mb-3"},W=e("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址或上傳圖檔",-1),X=["src"],Y=e("h3",null,"多圖新增",-1),Z={key:0},ee=["src"],te={key:0},se={class:"col-sm-8"},oe={class:"mb-3"},le=e("label",{for:"title",class:"form-label"},"標題",-1),ie={class:"row"},ne={class:"mb-3 col-md-6"},de=e("label",{for:"category",class:"form-label"},"分類",-1),re={class:"mb-3 col-md-6"},ae=e("label",{for:"price",class:"form-label"},"單位",-1),ce={class:"row"},ue={class:"mb-3 col-md-6"},pe=e("label",{for:"origin_price",class:"form-label"},"原價",-1),me={class:"mb-3 col-md-6"},he=e("label",{for:"price",class:"form-label"},"售價",-1),_e=e("hr",null,null,-1),fe={class:"bg-light p-3"},ge={class:"row"},be={class:"col-md-6"},Pe={class:"form-check mb-2"},ve=e("label",{class:"form-check-label",for:"classOpen"}," 已開課 ",-1),ke={class:"form-check mb-2"},ye=e("label",{class:"form-check-label",for:"classFunding"}," 募資中 ",-1),Ce={class:"row"},De={class:"mb-3 col-md-6"},Ue=e("label",{for:"funding_price",class:"form-label"},"募資價(募資課程必填)",-1),Le=["disabled"],Ve={class:"mb-3 col-md-6"},xe=e("label",{for:"fundingEndDate",class:"form-label"},"募資結束日(募資課程必填)",-1),Se=["disabled"],Ee=e("hr",null,null,-1),we={class:"mb-3"},Te=e("label",{for:"description",class:"form-label"},"課程簡述(短)",-1),Ie={class:"mb-3"},Me=e("label",{for:"content",class:"form-label"},"課程說明(長)",-1),Ae={class:"mb-3"},Fe=e("label",{for:"teacherInfo",class:"form-label"},"講師介紹",-1),Oe={class:"mb-3"},Re=e("label",{for:"skillTree",class:"form-label"},"技能收穫",-1),$e={class:"mb-3"},Be={class:"form-check"},He=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ne={class:"modal-footer"},je=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1);function qe(i,t,n,_,s,a){const D=b("LoadingVue"),P=b("ckeditor");return d(),r("div",O,[f(D,{active:i.isLoading,"onUpdate:active":t[0]||(t[0]=o=>i.isLoading=o)},null,8,["active"]),e("div",R,[e("div",$,[e("div",B,[e("h5",H,[n.checkedStatus==="new"?(d(),r("span",N," 新增 ")):n.checkedStatus==="edit"?(d(),r("span",j," 編輯 ")):h("",!0),C(" 課程 ")]),q]),e("div",z,[e("div",G,[e("div",J,[e("div",K,[e("div",Q,[W,c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.tempProduct.imageUrl=o),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[p,s.tempProduct.imageUrl]]),e("input",{type:"file",id:"picFile",style:{display:"none"},ref:"fileInput",onChange:t[2]||(t[2]=o=>a.uploadPic("main"))},null,544),e("button",{onClick:t[3]||(t[3]=o=>this.$refs.fileInput.click()),class:"btn btn-outline-primary mt-2 btn-sm"}," 上傳圖片 ")]),e("img",{class:"img-fluid",src:s.tempProduct.imageUrl,alt:""},null,8,X)]),Y,e("div",null,[e("input",{type:"file",style:{display:"none"},ref:"imgsFileInput",id:"picsFile",onChange:t[4]||(t[4]=(...o)=>a.uploadSubPic&&a.uploadSubPic(...o))},null,544),e("button",{onClick:t[5]||(t[5]=o=>this.$refs.imgsFileInput.click()),class:g(["btn btn-outline-primary btn-sm mb-2",{disabled:!this.tempProduct.imagesUrl}])}," 上傳圖片 ",2)]),e("div",null,[Array.isArray(s.tempProduct.imagesUrl)?(d(),r("div",Z,[(d(!0),r(y,null,L(s.tempProduct.imagesUrl,(o,l)=>(d(),r("img",{key:l+l,class:"img-fluid",src:s.tempProduct.imagesUrl[l],style:{margin:"0.5rem 0"}},null,8,ee))),128)),!s.tempProduct.imagesUrl.length||s.tempProduct.imagesUrl[s.tempProduct.imagesUrl.length-1]?(d(),r("button",{key:0,onClick:t[6]||(t[6]=o=>s.tempProduct.imagesUrl.push("")),class:"btn btn-outline-dark btn-sm d-block w-100"}," 新增圖片 ")):h("",!0),s.tempProduct.imagesUrl.length>0?(d(),r("button",{key:1,onClick:t[7]||(t[7]=o=>s.tempProduct.imagesUrl.pop()),class:"btn btn-outline-danger btn-sm d-block w-100",style:{margin:"0.5rem 0"}}," 刪除圖片 ")):h("",!0)])):h("",!0)]),s.tempProduct.imagesUrl===void 0?(d(),r("div",te,[e("button",{class:"btn btn-outline-dark btn-sm d-block w-100",type:"button",onClick:t[8]||(t[8]=(...o)=>a.createPic&&a.createPic(...o))}," 新增圖片 + ")])):h("",!0)]),e("div",se,[e("div",oe,[le,c(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.tempProduct.title=o),id:"title",type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[p,s.tempProduct.title]])]),e("div",ie,[e("div",ne,[de,c(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.tempProduct.category=o),id:"category",type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[p,s.tempProduct.category]])]),e("div",re,[ae,c(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>s.tempProduct.unit=o),id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[p,s.tempProduct.unit]])])]),e("div",ce,[e("div",ue,[pe,c(e("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>s.tempProduct.origin_price=o),id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[p,s.tempProduct.origin_price,void 0,{number:!0}]])]),e("div",me,[he,c(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.tempProduct.price=o),id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[p,s.tempProduct.price,void 0,{number:!0}]])])]),_e,e("div",fe,[e("div",ge,[e("div",be,[e("div",Pe,[c(e("input",{"onUpdate:modelValue":t[14]||(t[14]=o=>s.tempProduct.courseStatus=o),value:"classOpen",class:"form-check-input",type:"radio",name:"courseStatus",id:"classOpen"},null,512),[[x,s.tempProduct.courseStatus]]),ve]),e("div",ke,[c(e("input",{"onUpdate:modelValue":t[15]||(t[15]=o=>s.tempProduct.courseStatus=o),value:"classFunding",class:"form-check-input",type:"radio",name:"courseStatus",id:"classFunding"},null,512),[[x,s.tempProduct.courseStatus]]),ye])])]),e("div",Ce,[e("div",De,[Ue,c(e("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":t[16]||(t[16]=o=>s.tempProduct.funding_price=o),id:"funding_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入募資優惠價"},null,8,Le),[[p,s.tempProduct.funding_price,void 0,{number:!0}]])]),e("div",Ve,[xe,C(" "+m(a.switchTimeStamp(s.tempProduct.fundingEndDate))+" ",1),c(e("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":t[17]||(t[17]=o=>s.tempProduct.fundingEndDate=o),id:"fundingEndDate",type:"datetime-local",class:"form-control"},null,8,Se),[[p,s.tempProduct.fundingEndDate]])])])]),Ee,e("div",we,[Te,c(e("textarea",{"onUpdate:modelValue":t[18]||(t[18]=o=>s.tempProduct.description=o),id:"description",type:"text",class:"form-control",placeholder:"請輸入課程簡述"},`
                `,512),[[p,s.tempProduct.description]])]),e("div",Ie,[Me,c(e("textarea",{"onUpdate:modelValue":t[19]||(t[19]=o=>s.tempProduct.content=o),id:"description",type:"text",class:"form-control",placeholder:"請輸入課程說明內容"},`
                `,512),[[p,s.tempProduct.content]])]),e("div",Ae,[Fe,f(P,{editor:s.editor,modelValue:s.tempProduct.teacherInfo,"onUpdate:modelValue":t[20]||(t[20]=o=>s.tempProduct.teacherInfo=o)},null,8,["editor","modelValue"])]),e("div",Oe,[Re,f(P,{editor:s.editor,modelValue:s.tempProduct.skillTree,"onUpdate:modelValue":t[21]||(t[21]=o=>s.tempProduct.skillTree=o)},null,8,["editor","modelValue"])]),e("div",$e,[e("div",Be,[c(e("input",{"onUpdate:modelValue":t[22]||(t[22]=o=>s.tempProduct.is_enabled=o),id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[M,s.tempProduct.is_enabled]]),He])])])])]),e("div",Ne,[je,e("button",{onClick:t[23]||(t[23]=(...o)=>a.postCourse&&a.postCourse(...o)),type:"button",class:"btn btn-danger"}," 送出 ")])])])],512)}const ze=w(F,[["render",qe]]),{VITE_APP_URL:S,VITE_APP_PATH:E}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vite-sideproject-w6/",MODE:"production",DEV:!1,PROD:!0},Ge={data(){return{isLoading:!1,allCourseList:{},currentPage:1,delClassTitle:"",delClassId:"",checkedCourse:{},checkedStatus:"",todayDateStr:"",leftDay:""}},components:{CourseModal:ze,DelModal:A},mounted(){this.getCoursesList(),setInterval(()=>{this.todayDateStr=Date.parse(new Date)},6e4)},created(){this.startTimer()},beforeUnmount(){clearInterval(this.timer)},methods:{startTimer(){this.countDay(),this.timer=setInterval(this.countDay,6e4)},countDay(i){this.todayDateStr=Date.parse(new Date);const t=i-this.todayDateStr;if(t<0)clearInterval(this.timer),this.leftDay="已結束";else{const n=Math.floor(t/864e5),_=Math.floor(t%(1e3*60*60*24)/(1e3*60*60)),s=Math.floor(t%(1e3*60*60)/(1e3*60));this.leftDay=`剩餘天數：${n}天${_}小時${s}分鐘`}},getCoursesList(i=1){this.isLoading=!0,this.$http.get(`${S}/api/${E}/admin/products?page=${i}`).then(t=>{this.isLoading=!1,this.allCourseList=t.data,t.data.success===!0&&u.fire({icon:"success",title:"成功取得產品資訊"})}).catch(t=>{this.isLoading=!1,u.fire({icon:"error",title:t.response.data.message})})},changePage(i){this.currentPage=i,this.getCoursesList(this.currentPage)},openModal(i,t){t==="edit"?this.checkedCourse=i:t==="new"&&(this.checkedCourse={}),this.checkedStatus=t,this.$refs.courseModal.showModal()},openDelModal(i,t){this.delClassTitle=i,this.delClassId=t,this.$refs.deleteModal.showModal()},delCourse(){const i=this.delClassId;this.$http.delete(`${S}/api/${E}/admin/product/${i}`).then(t=>{u.fire({icon:"success",title:t.data.message}),this.getCoursesList(this.currentPage)}).catch(t=>{u.fire({icon:"error",title:t.response.data.message})})}}},Je=e("h3",{class:"text-center mt-5"},"課程管理",-1),Ke={class:"text-end"},Qe={class:"card mt-4"},We={class:"card-body p-0"},Xe={class:"table-responsive text-nowrap"},Ye={class:"table table-hover"},Ze=e("thead",{class:"border-bottom border-3 bg-light"},[e("tr",{class:"align-middle"},[e("th",{scope:"col ",class:"ps-3"},"分類"),e("th",{scope:"col",class:"py-3"},"課程名稱"),e("th",{scope:"col"},"課程狀態"),e("th",{scope:"col",class:"text-end"},"原價"),e("th",{scope:"col",class:"text-end"},"售價"),e("th",{scope:"col",class:"text-end"},"是否上線"),e("th",{scope:"col",class:"text-end pe-3"},"編輯")])],-1),et={class:"py-3 ps-3"},tt={class:""},st={key:0},ot={class:"text-success"},lt={key:0,class:"mb-0"},it=e("br",null,null,-1),nt={key:1,class:"mb-0"},dt={key:1},rt={class:"text-end"},at={class:"text-end"},ct={class:"text-end"},ut={class:"text-end pe-3 text-danger"},pt={class:"btn-group",role:"group"},mt=["onClick"],ht=["onClick"],_t={class:"card-footer bg-transparent border-0 pb-0"},ft={"aria-label":"Page navigation mb-0 "},gt={key:0,class:"pagination justify-content-center"},bt=e("a",{class:"page-link",href:"","aria-label":"Previous"},[e("span",{"aria-hidden":"true"},"«")],-1),Pt=[bt],vt=["onClick"],kt={class:"page-link",href:"#"},yt=e("a",{class:"page-link",href:"#","aria-label":"Next"},[e("span",{"aria-hidden":"true"},"»")],-1),Ct=[yt];function Dt(i,t,n,_,s,a){const D=b("LoadingVue"),P=b("CourseModal"),o=b("DelModal");return d(),r(y,null,[Je,e("div",Ke,[e("button",{onClick:t[0]||(t[0]=l=>a.openModal(0,"new")),class:"btn btn-outline-secondary"}," 新增課程 ")]),f(D,{active:s.isLoading,"onUpdate:active":t[1]||(t[1]=l=>s.isLoading=l)},null,8,["active"]),e("div",Qe,[e("div",We,[e("div",Xe,[e("table",Ye,[Ze,e("tbody",null,[(d(!0),r(y,null,L(s.allCourseList.products,l=>(d(),r("tr",{class:"align-middle",key:l.id},[e("td",et,m(l.category),1),e("td",tt,m(l.title),1),l.courseStatus==="classFunding"?(d(),r("td",st,[C(" 募資中 "),e("span",ot,[typeof l.fundingEndDate!="number"?(d(),r("p",lt," 結束日 "+m(l.fundingEndDate),1)):h("",!0),it,C(" "+m(a.countDay(l.fundingEndDate))+" ",1),typeof l.fundingEndDate=="number"?(d(),r("p",nt,m(s.leftDay),1)):h("",!0)])])):l.courseStatus==="classOpen"?(d(),r("td",dt,"已開課")):h("",!0),e("td",rt,m(l.origin_price)+"4",1),e("td",at,m(l.price)+"5",1),e("td",ct,[e("div",{class:g(["badge rounded-pill",[{"bg-warning":l.is_enabled===1},{"bg-dark":l.is_enabled===0||!l.is_enabled}]])},m(l.is_enabled?"上線中":"未上"),3)]),e("td",ut,[e("div",pt,[e("button",{onClick:V=>a.openModal(l,"edit"),type:"button",class:"btn btn-outline-dark btn-sm"}," 編輯 ",8,mt),e("button",{onClick:V=>a.openDelModal(l.title,l.id),type:"button",class:"btn btn-outline-primary btn-sm"}," 刪除 ",8,ht)])])]))),128))])])])]),e("div",_t,[e("nav",ft,[s.allCourseList.pagination?(d(),r("ul",gt,[e("li",{class:g(["page-item",{disabled:!s.allCourseList.pagination.has_pre}]),onClick:t[2]||(t[2]=U(l=>a.changePage(s.currentPage-1),["prevent"]))},Pt,2),(d(!0),r(y,null,L(s.allCourseList.pagination.total_pages,l=>(d(),r("li",{class:g(["page-item",{active:l===s.currentPage}]),key:l+"hlllq",onClick:U(V=>a.changePage(l),["prevent"])},[e("a",kt,m(l),1)],10,vt))),128)),e("li",{class:g(["page-item",{disabled:!s.allCourseList.pagination.has_next}]),onClick:t[3]||(t[3]=U(l=>a.changePage(s.currentPage+1),["prevent"]))},Ct,2)])):h("",!0)])])]),f(P,{ref:"courseModal","checked-course":s.checkedCourse,"checked-status":s.checkedStatus,onRanderCourseList:t[4]||(t[4]=l=>a.getCoursesList(s.currentPage))},null,8,["checked-course","checked-status"]),f(o,{ref:"deleteModal","del-class-title":s.delClassTitle,"del-class-id":s.delClassId,onDelItem:a.delCourse},null,8,["del-class-title","del-class-id","onDelItem"])],64)}const Et=w(Ge,[["render",Dt]]);export{Et as default};
