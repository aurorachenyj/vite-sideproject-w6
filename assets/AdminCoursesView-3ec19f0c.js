import{M as I}from"./modal-7a362480.js";import{T as m}from"./Toast-54279abc.js";import{C as T}from"./ckeditor-7fe22c72.js";import{_ as M,r as y,o as d,c as r,a as e,k as p,l as D,w as a,v as u,J as P,F as C,E as V,L as S,t as h,e as f,M as A,h as U}from"./index-123c8591.js";import{D as F}from"./DelModal-af36bd30.js";import{h as w}from"./zh-tw-a6f00c05.js";import"./base-component-2afd601b.js";const{VITE_APP_URL:v,VITE_APP_PATH:k}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vue-learnFund/",MODE:"production",DEV:!1,PROD:!0},N={data(){return{modal:"",isLoadong:!1,tempProduct:{imageUrl:"",imagesUrl:[]},editor:T,uploadPicData:{},uploadImgs:{}}},props:{checkedCourse:{},checkedStatus:{}},mounted(){this.modal=new I(this.$refs.modal),this.uploadPicData=document.querySelector("#picFile"),this.uploadImgs=document.querySelector("#picsFile")},watch:{checkedCourse(){this.tempProduct=this.checkedCourse}},methods:{switchTimeStamp(l){if(typeof l!="number"||Number.isNaN(l))return;const t=new Date(l),c=t.getFullYear(),_=("0"+(t.getMonth()+1)).slice(-2),s=("0"+t.getDate()).slice(-2),n=("0"+t.getHours()).slice(-2),b=("0"+t.getMinutes()).slice(-2),o=`${c}-${_}-${s}T${n}:${b}`;return this.tempProduct.fundingEndDate=o},createPic(){this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push("")},uploadPic(){this.isLoadong=!0;const l=this.uploadPicData.files[0],t=new FormData;t.append("file-to-upload",l),this.$http.post(` ${v}/api/${k}/admin/upload`,t).then(c=>{this.tempProduct.imageUrl=c.data.imageUrl,this.isLoadong=!1,c.data.success===!0&&m.fire({icon:"success",title:"成功上傳圖片"})}).catch(c=>{this.isLoadong=!1,m.fire({icon:"error",title:c.response.data.message})})},uploadSubPic(){this.isLoadong=!0;const l=this.uploadImgs.files[0],t=new FormData;t.append("file-to-upload",l),this.$http.post(` ${v}/api/${k}/admin/upload`,t).then(c=>{this.tempProduct.imagesUrl.push(c.data.imageUrl),this.isLoadong=!1,c.data.success===!0&&m.fire({icon:"success",title:"成功上傳圖片"})}).catch(c=>{this.isLoadong=!1,m.fire({icon:"error",title:c.response.data.message})})},postCourse(){if(this.tempProduct.fundingEndDate=Date.parse(this.tempProduct.fundingEndDate),!this.tempProduct.courseStatus){m.fire({icon:"error",title:"課程狀態必填"});return}if(this.tempProduct.courseStatus==="classFunding"&&(!this.tempProduct.fundingEndDate||!this.tempProduct.funding_price||!this.tempProduct.funding_target)){m.fire({icon:"error",title:"募資到期日、達標目標和募資價格必填"});return}let l="",t="";this.checkedStatus==="new"?(l=`${v}/api/${k}/admin/product`,t="post"):this.checkedStatus==="edit"&&(l=`${v}/api/${k}/admin/product/${this.tempProduct.id}`,t="put");const c=this.tempProduct;this.$http[t](l,{data:c}).then(_=>{m.fire({icon:"success",title:_.data.message}),this.$emit("randerCourseList"),this.modal.hide(),this.tempProduct={}}).catch(_=>{m.fire({icon:"error",title:_.response.data.message})})},hideModal(){this.modal.hide()},showModal(){this.modal.show()}}},O={class:"modal modal-xl modal-dialog-scrollable fade",ref:"modal",tabindex:"-1","aria-hidden":"true"},R={class:"modal-dialog"},H={class:"modal-content"},B={class:"modal-header"},q={class:"modal-title"},z={key:0},j={key:1},J=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},G={class:"row"},K={class:"col-sm-4"},Q={class:"mb-2"},W={class:"mb-3"},X=e("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址或上傳圖檔",-1),Z=["src"],$=e("h3",null,"多圖新增",-1),ee={key:0},te=["src"],se={key:0},oe={class:"col-sm-8"},le={class:"mb-3"},ie=e("label",{for:"title",class:"form-label"},"標題",-1),ne={class:"row"},de={class:"mb-3 col-md-6"},re=e("label",{for:"category",class:"form-label"},"分類",-1),ce={class:"mb-3 col-md-6"},ae=e("label",{for:"unit",class:"form-label"},"課程總時長",-1),ue={class:"row"},me={class:"mb-3 col-md-6"},pe=e("label",{for:"classSection",class:"form-label"},"章節數 ",-1),he={class:"mb-3 col-md-6"},_e=e("label",{for:"classUnit",class:"form-label"},"單元數",-1),be={class:"row"},fe={class:"mb-3 col-md-6"},ge=e("label",{for:"origin_price",class:"form-label"},"原價",-1),Pe={class:"mb-3 col-md-6"},ve=e("label",{for:"price",class:"form-label"},"售價",-1),ke=e("hr",null,null,-1),ye={class:"bg-light p-3"},Ce={class:"row"},Ue={class:"col-md-8"},De={class:"form-check mb-2"},Ve=e("label",{class:"form-check-label",for:"classOpen"}," 已開課 ",-1),Le={class:"form-check mb-2"},Se=e("label",{class:"form-check-label",for:"classFunding"}," 募資中 (以下三欄位募資課程必填 ) ",-1),we={key:0,class:"row"},xe={class:"mb-3 col-md-3"},Ee=e("label",{for:"funding_price",class:"form-label"},"募資價*",-1),Me=["disabled"],Ie={class:"mb-3 col-md-3"},Te=e("label",{for:"funding_target",class:"form-label"},"達標金額*",-1),Ae=["disabled"],Fe={class:"mb-3 col-md-6"},Ne=e("label",{for:"fundingEndDate",class:"form-label"},"募資結束日*",-1),Oe=["disabled"],Re=e("hr",null,null,-1),He={class:"mb-3"},Be=e("label",{for:"description",class:"form-label"},"課程簡述(短)",-1),qe={class:"mb-3"},ze=e("label",{for:"content",class:"form-label"},"課程章節介紹(長)",-1),je={class:"mb-3"},Je=e("label",{for:"teacherInfo",class:"form-label"},"講師介紹",-1),Ye={class:"mb-3"},Ge=e("label",{for:"skillTree",class:"form-label"},"技能收穫",-1),Ke={class:"mb-3"},Qe={class:"form-check"},We=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Xe={class:"modal-footer"},Ze=e("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"}," 取消 ",-1);function $e(l,t,c,_,s,n){const b=y("ckeditor");return d(),r("div",O,[e("div",R,[e("div",H,[e("div",B,[e("h5",q,[c.checkedStatus==="new"?(d(),r("span",z," 新增 ")):c.checkedStatus==="edit"?(d(),r("span",j," 編輯 ")):p("",!0),D(" 課程 ")]),J]),e("div",Y,[e("div",G,[e("div",K,[e("div",Q,[e("div",W,[X,a(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.tempProduct.imageUrl=o),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[u,s.tempProduct.imageUrl]]),e("input",{type:"file",id:"picFile",style:{display:"none"},ref:"fileInput",onChange:t[1]||(t[1]=o=>n.uploadPic("main"))},null,544),e("button",{onClick:t[2]||(t[2]=o=>this.$refs.fileInput.click()),class:"btn btn-outline-primary mt-2 btn-sm"}," 上傳圖片 ")]),e("img",{class:"img-fluid",src:s.tempProduct.imageUrl,alt:""},null,8,Z)]),$,e("div",null,[e("input",{type:"file",style:{display:"none"},ref:"imgsFileInput",id:"picsFile",onChange:t[3]||(t[3]=(...o)=>n.uploadSubPic&&n.uploadSubPic(...o))},null,544),e("button",{onClick:t[4]||(t[4]=o=>this.$refs.imgsFileInput.click()),class:P(["btn btn-outline-primary btn-sm mb-2",{disabled:!this.tempProduct.imagesUrl}])}," 上傳圖片 ",2)]),e("div",null,[Array.isArray(s.tempProduct.imagesUrl)?(d(),r("div",ee,[(d(!0),r(C,null,V(s.tempProduct.imagesUrl,(o,g)=>(d(),r("img",{key:g+g,class:"img-fluid",src:s.tempProduct.imagesUrl[g],style:{margin:"0.5rem 0"}},null,8,te))),128)),!s.tempProduct.imagesUrl.length||s.tempProduct.imagesUrl[s.tempProduct.imagesUrl.length-1]?(d(),r("button",{key:0,onClick:t[5]||(t[5]=o=>s.tempProduct.imagesUrl.push("")),class:"btn btn-outline-dark btn-sm d-block w-100"}," 新增圖片 ")):p("",!0),s.tempProduct.imagesUrl.length>0?(d(),r("button",{key:1,onClick:t[6]||(t[6]=o=>s.tempProduct.imagesUrl.pop()),class:"btn btn-outline-danger btn-sm d-block w-100",style:{margin:"0.5rem 0"}}," 刪除圖片 ")):p("",!0)])):p("",!0)]),s.tempProduct.imagesUrl===void 0?(d(),r("div",se,[e("button",{class:"btn btn-outline-dark btn-sm d-block w-100",type:"button",onClick:t[7]||(t[7]=(...o)=>n.createPic&&n.createPic(...o))}," 新增圖片 + ")])):p("",!0)]),e("div",oe,[e("div",le,[ie,a(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.tempProduct.title=o),id:"title",type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[u,s.tempProduct.title]])]),e("div",ne,[e("div",de,[re,a(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.tempProduct.category=o),id:"category",type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[u,s.tempProduct.category]])]),e("div",ce,[ae,a(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.tempProduct.unit=o),id:"unit",type:"text",class:"form-control",placeholder:"請輸入小時數"},null,512),[[u,s.tempProduct.unit]])])]),e("div",ue,[e("div",me,[pe,a(e("input",{"onUpdate:modelValue":t[11]||(t[11]=o=>s.tempProduct.classSectionNum=o),id:"classSection",type:"number",class:"form-control",placeholder:"請輸入章節數量"},null,512),[[u,s.tempProduct.classSectionNum]])]),e("div",he,[_e,a(e("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>s.tempProduct.classUnitNum=o),id:"classUnit",type:"number",class:"form-control",placeholder:"請輸入單元數量"},null,512),[[u,s.tempProduct.classUnitNum]])])]),e("div",be,[e("div",fe,[ge,a(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.tempProduct.origin_price=o),id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[u,s.tempProduct.origin_price,void 0,{number:!0}]])]),e("div",Pe,[ve,a(e("input",{"onUpdate:modelValue":t[14]||(t[14]=o=>s.tempProduct.price=o),id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[u,s.tempProduct.price,void 0,{number:!0}]])])]),ke,e("div",ye,[e("div",Ce,[e("div",Ue,[e("div",De,[a(e("input",{"onUpdate:modelValue":t[15]||(t[15]=o=>s.tempProduct.courseStatus=o),value:"classOpen",class:"form-check-input",type:"radio",name:"courseStatus",id:"classOpen"},null,512),[[S,s.tempProduct.courseStatus]]),Ve]),e("div",Le,[a(e("input",{"onUpdate:modelValue":t[16]||(t[16]=o=>s.tempProduct.courseStatus=o),value:"classFunding",class:"form-check-input",type:"radio",name:"courseStatus",id:"classFunding"},null,512),[[S,s.tempProduct.courseStatus]]),Se])])]),s.tempProduct.courseStatus==="classFunding"?(d(),r("div",we,[e("div",xe,[Ee,a(e("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":t[17]||(t[17]=o=>s.tempProduct.funding_price=o),id:"funding_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入募資優惠價"},null,8,Me),[[u,s.tempProduct.funding_price,void 0,{number:!0}]])]),e("div",Ie,[Te,a(e("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":t[18]||(t[18]=o=>s.tempProduct.funding_target=o),id:"funding_target",type:"number",min:"0",class:"form-control",placeholder:"請輸入募資達標金額"},null,8,Ae),[[u,s.tempProduct.funding_target,void 0,{number:!0}]])]),e("div",Fe,[Ne,D(" "+h(n.switchTimeStamp(s.tempProduct.fundingEndDate))+" ",1),a(e("input",{disabled:s.tempProduct.courseStatus==="classOpen","onUpdate:modelValue":t[19]||(t[19]=o=>s.tempProduct.fundingEndDate=o),id:"fundingEndDate",type:"datetime-local",class:"form-control"},null,8,Oe),[[u,s.tempProduct.fundingEndDate]])])])):p("",!0)]),Re,e("div",He,[Be,a(e("textarea",{"onUpdate:modelValue":t[20]||(t[20]=o=>s.tempProduct.description=o),id:"description",type:"text",class:"form-control",placeholder:"請輸入課程簡述"},`
                `,512),[[u,s.tempProduct.description]])]),e("div",qe,[ze,f(b,{editor:s.editor,modelValue:s.tempProduct.content,"onUpdate:modelValue":t[21]||(t[21]=o=>s.tempProduct.content=o)},null,8,["editor","modelValue"])]),e("div",je,[Je,f(b,{editor:s.editor,modelValue:s.tempProduct.teacherInfo,"onUpdate:modelValue":t[22]||(t[22]=o=>s.tempProduct.teacherInfo=o)},null,8,["editor","modelValue"])]),e("div",Ye,[Ge,f(b,{editor:s.editor,modelValue:s.tempProduct.skillTree,"onUpdate:modelValue":t[23]||(t[23]=o=>s.tempProduct.skillTree=o)},null,8,["editor","modelValue"])]),e("div",Ke,[e("div",Qe,[a(e("input",{"onUpdate:modelValue":t[24]||(t[24]=o=>s.tempProduct.is_enabled=o),id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[A,s.tempProduct.is_enabled]]),We])])])])]),e("div",Xe,[Ze,e("button",{onClick:t[25]||(t[25]=(...o)=>n.postCourse&&n.postCourse(...o)),type:"button",class:"btn btn-danger"}," 送出 ")])])])],512)}const et=M(N,[["render",$e]]),{VITE_APP_URL:x,VITE_APP_PATH:E}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"aurora-path",BASE_URL:"/vue-learnFund/",MODE:"production",DEV:!1,PROD:!0},tt={data(){return{isLoading:!1,allCourseList:{},currentPage:1,totalPage:1,delClassTitle:"",delClassId:"",checkedCourse:{},checkedStatus:""}},components:{CourseModal:et,DelModal:F},mounted(){this.getCoursesList()},created(){w.locale("zh-tw")},beforeUnmount(){},methods:{countLeftDay(l){return Date.parse(new Date)>l?"已結束募資":(l=new Date(l).toISOString(),w(l).fromNow())},getCoursesList(l=1){this.isLoading=!0,this.$http.get(`${x}/api/${E}/admin/products?page=${l}`).then(t=>{this.isLoading=!1,this.allCourseList=t.data,this.totalPage=t.data.pagination.total_pages,t.data.success===!0&&m.fire({icon:"success",title:"成功取得產品資訊"})}).catch(t=>{this.isLoading=!1,m.fire({icon:"error",title:t.response.data.message})})},changePage(l){l>this.totalPage||l===0||(this.currentPage=l,this.getCoursesList(this.currentPage))},openModal(l,t){t==="edit"?this.checkedCourse=l:t==="new"&&(this.checkedCourse={}),this.checkedStatus=t,this.$refs.courseModal.showModal()},openDelModal(l,t){this.delClassTitle=l,this.delClassId=t,this.$refs.deleteModal.showModal()},delCourse(){const l=this.delClassId;this.$http.delete(`${x}/api/${E}/admin/product/${l}`).then(t=>{m.fire({icon:"success",title:t.data.message}),this.getCoursesList(this.currentPage)}).catch(t=>{m.fire({icon:"error",title:t.response.data.message})})}}},st=e("h3",{class:"text-center mt-5"},"課程管理",-1),ot={class:"text-end"},lt={class:"card mt-4"},it={class:"card-body p-0"},nt={class:"table-responsive text-nowrap"},dt={class:"table table-hover"},rt=e("thead",{class:"border-bottom border-3 bg-light"},[e("tr",{class:"align-middle"},[e("th",{scope:"col ",class:"ps-3"},"分類"),e("th",{scope:"col",class:"py-3"},"課程名稱"),e("th",{scope:"col"},"課程狀態"),e("th",{scope:"col",class:"text-end"},"原價"),e("th",{scope:"col",class:"text-end"},"售價"),e("th",{scope:"col",class:"text-end"},"是否上線"),e("th",{scope:"col",class:"text-end pe-3"},"編輯")])],-1),ct={class:"py-3 ps-3"},at={class:""},ut={key:0},mt={class:"text-success"},pt={key:0,class:"mb-0"},ht=e("br",null,null,-1),_t={key:1,class:"mb-0"},bt={key:1},ft={class:"text-end"},gt={class:"text-end"},Pt={class:"text-end"},vt={class:"text-end pe-3 text-danger"},kt={class:"btn-group",role:"group"},yt=["onClick"],Ct=["onClick"],Ut={class:"card-footer bg-transparent border-0 pb-0"},Dt={"aria-label":"Page navigation mb-0 "},Vt={key:0,class:"pagination justify-content-center"},Lt=e("a",{class:"page-link",href:"","aria-label":"Previous"},[e("span",{"aria-hidden":"true"},"«")],-1),St=[Lt],wt=["onClick"],xt={class:"page-link",href:"#"},Et=e("a",{class:"page-link",href:"#","aria-label":"Next"},[e("span",{"aria-hidden":"true"},"»")],-1),Mt=[Et];function It(l,t,c,_,s,n){const b=y("LoadingVue"),o=y("CourseModal"),g=y("DelModal");return d(),r(C,null,[st,e("div",ot,[e("button",{onClick:t[0]||(t[0]=i=>n.openModal(0,"new")),class:"btn btn-outline-secondary"}," 新增課程 ")]),f(b,{active:s.isLoading,"onUpdate:active":t[1]||(t[1]=i=>s.isLoading=i)},null,8,["active"]),e("div",lt,[e("div",it,[e("div",nt,[e("table",dt,[rt,e("tbody",null,[(d(!0),r(C,null,V(s.allCourseList.products,i=>(d(),r("tr",{class:"align-middle",key:i.id},[e("td",ct,h(i.category),1),e("td",at,h(i.title),1),i.courseStatus==="classFunding"?(d(),r("td",ut,[D(" 募資中 "),e("span",mt,[typeof i.fundingEndDate!="number"?(d(),r("p",pt," 結束日 "+h(i.fundingEndDate),1)):p("",!0),ht,typeof i.fundingEndDate=="number"?(d(),r("p",_t,h(n.countLeftDay(i.fundingEndDate)),1)):p("",!0)])])):i.courseStatus==="classOpen"?(d(),r("td",bt,"已開課")):p("",!0),e("td",ft,h(i.origin_price),1),e("td",gt,h(i.price),1),e("td",Pt,[e("div",{class:P(["badge rounded-pill",[{"bg-warning":i.is_enabled===1},{"bg-dark":i.is_enabled===0||!i.is_enabled}]])},h(i.is_enabled?"上線中":"未上"),3)]),e("td",vt,[e("div",kt,[e("button",{onClick:L=>n.openModal(i,"edit"),type:"button",class:"btn btn-outline-dark btn-sm"}," 編輯 ",8,yt),e("button",{onClick:L=>n.openDelModal(i.title,i.id),type:"button",class:"btn btn-outline-primary btn-sm"}," 刪除 ",8,Ct)])])]))),128))])])])]),e("div",Ut,[e("nav",Dt,[s.allCourseList.pagination?(d(),r("ul",Vt,[e("li",{class:P(["page-item",{disabled:!s.allCourseList.pagination.has_pre}]),onClick:t[2]||(t[2]=U(i=>n.changePage(s.currentPage-1),["prevent"]))},St,2),(d(!0),r(C,null,V(s.allCourseList.pagination.total_pages,i=>(d(),r("li",{class:P(["page-item",{active:i===s.currentPage}]),key:i+"hlllq",onClick:U(L=>n.changePage(i),["prevent"])},[e("a",xt,h(i),1)],10,wt))),128)),e("li",{class:P(["page-item",{disabled:!s.allCourseList.pagination.has_next}]),onClick:t[3]||(t[3]=U(i=>n.changePage(s.currentPage+1),["prevent"]))},Mt,2)])):p("",!0)])])]),f(o,{ref:"courseModal","checked-course":s.checkedCourse,"checked-status":s.checkedStatus,onRanderCourseList:t[4]||(t[4]=i=>n.getCoursesList(s.currentPage))},null,8,["checked-course","checked-status"]),f(g,{ref:"deleteModal","del-class-title":s.delClassTitle,"del-class-id":s.delClassId,onDelItem:n.delCourse},null,8,["del-class-title","del-class-id","onDelItem"])],64)}const Bt=M(tt,[["render",It]]);export{Bt as default};
